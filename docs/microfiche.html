<!DOCTYPE html>

<html>
<head>
  <title>Microfiche.js v1.4.0</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Microfiche.js v1.4.0</h1>
<h2>Usage</h2>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche();
$(&#39;.my-slideshow&#39;).microfiche({ cyclic: true, button: false });
$(&#39;.my-slideshow&#39;).microfiche({ slideByPages: 1 });</code></pre>
<h2>Options</h2>
<p>The following options can be passed the first time <code>microfiche</code> is called
on an element.</p>
<h3>cyclic</h3>
<p>If true, microfiche wraps around at front and beginning of the slideshow.
This option is false by default.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ cyclic: true });</code></pre>
<h3>buttons</h3>
<p>If true, microfiche will create previous/next buttons.
This option is true by default.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ buttons: false });</code></pre>
<h3>bullets</h3>
<p>If true, microfiche will create bullets for the pages available.
This option is also true by default.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ bullets: false });</code></pre>
<h2>Commands</h2>
<p>The following commands can be run on a microfiche&#39;d element at any point,
including in the first call.</p>
<h3>slideByPages</h3>
<p>Slides <code>n</code> screenfuls (negative <code>n</code> goes backwards).</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ slideByPages: n });</code></pre>
<h3>slideToPage</h3>
<p>Slides to the <code>nth</code> screenful.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ slideToPage: n });</code></pre>
<h3>slideToPoint</h3>
<p>Slides to point <code>x</code> (rounded and constrained appropriately).</p>
<pre><code>$(&#39;.my-slideshow).microfiche({ slideToPoint: x });</code></pre>
<h3>jumpToPoint</h3>
<p>Jumps without animation to point x (again, rounded and constrained).</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ jumpToPoint: x });</code></pre>
<h3>autoplay</h3>
<p>Automatically advances every <code>n</code> seconds.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ autoplay: n });</code></pre>
<h3>autopause</h3>
<p>Automatically pause autoplay when the user hovers over the carousel.</p>
<pre><code>$(&#39;.my-slideshow&#39;).microfiche({ autoplay: n, autopause: true });</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>() {

window.Microfiche = <span class="keyword">function</span>(options) { <span class="keyword">this</span>.initialize(options); <span class="keyword">return</span> <span class="keyword">this</span>; };

Microfiche.VERSION = <span class="string">'1.4.0'</span>;

$.extend(Microfiche.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Default Options</h2>
<p>These may be overridden in the initializer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options: {
    autoplay        : <span class="literal">false</span>,
    autopause       : <span class="literal">false</span>,
    buttons         : <span class="literal">true</span>,
    bullets         : <span class="literal">true</span>,
    cyclic          : <span class="literal">false</span>,
    keyboard        : <span class="literal">false</span>,
    swipe           : <span class="literal">true</span>,
    clickToAdvance  : <span class="literal">false</span>,
    minDuration     : <span class="number">250</span>,
    duration        : <span class="number">500</span>,
    maxDuration     : <span class="number">500</span>,
    dragThreshold   : <span class="number">25</span>,
    elasticity      : <span class="number">0.5</span>,
    swipeThreshold  : <span class="number">0.125</span>,
    prevButtonLabel : <span class="string">'&amp;larr;'</span>,
    nextButtonLabel : <span class="string">'&amp;rarr;'</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Rather than relying on the literal position of <code>this.film</code>,
we keep a tab on the current destination.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  x: <span class="number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>Setup</h2>
<p>Build microfiche in steps.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initialize: <span class="keyword">function</span>(options) {
    <span class="keyword">this</span>.options = $.extend({}, <span class="keyword">this</span>.options, options);
    <span class="keyword">this</span>.el = $(options.el);
    <span class="keyword">this</span>.el.data(<span class="string">'microfiche'</span>, <span class="keyword">this</span>);
    <span class="keyword">this</span>.createFilm();
    <span class="keyword">this</span>.createScreen();
    <span class="keyword">this</span>.calibrate();

    <span class="keyword">if</span> (<span class="keyword">this</span>.film.width() &lt;= <span class="keyword">this</span>.screen.width()) <span class="keyword">return</span>;

    <span class="keyword">this</span>.createControls();
    <span class="keyword">this</span>.enableTouch();
    <span class="keyword">this</span>.enableKeyboard();
    <span class="keyword">this</span>.enableClick();
    <span class="keyword">this</span>.prepareCyclic();

    <span class="keyword">this</span>.run(<span class="keyword">this</span>.options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We create our film element, which we’ll slide back and forth in the screen.
Before appending any extra elements, we detach the existing children,
append them to film, and tell them to float so they’ll (hopefully) lay-out
nicely along the horizontal.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createFilm: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.film = $(<span class="string">'&lt;div class="microfiche-film"&gt;'</span>).
    css({ position: <span class="string">'absolute'</span> });
    <span class="keyword">this</span>.el.children().appendTo(<span class="keyword">this</span>.film).css({ float: <span class="string">'left'</span> });
    <span class="keyword">this</span>.prepareFilm &amp;&amp; <span class="keyword">this</span>.prepareFilm();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The screen is created and appended to our element, then the film is
appended to the screen. Screen manually takes its height from film.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createScreen: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.screen = $(<span class="string">'&lt;div class="microfiche-screen"&gt;'</span>).
    css({ position: <span class="string">'relative'</span>, overflow: <span class="string">'hidden'</span> }).
    appendTo(<span class="keyword">this</span>.el).
    append(<span class="keyword">this</span>.film);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Prepare duplicate content at either end, for our cyclic behaviour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  prepareCyclic: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.options.cyclic) <span class="keyword">return</span>;

    <span class="keyword">var</span> cloneL = <span class="keyword">this</span>.film.clone(),
        cloneR = <span class="keyword">this</span>.film.clone(),
        w = <span class="keyword">this</span>.film.width();

    cloneL.prependTo(<span class="keyword">this</span>.film).css({ position: <span class="string">'absolute'</span>, left: -w + <span class="string">'px'</span> });
    cloneR.appendTo(<span class="keyword">this</span>.film).css({ position: <span class="string">'absolute'</span>, left: w + <span class="string">'px'</span> });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>This slightly strange process tries to ensure we don’t get any wrapping
in <code>this.film</code>, then fixes the dimensions of <code>this.film</code> and <code>this.screen</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calibrate: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.screen.width(<span class="number">100000</span>);

    <span class="keyword">var</span> w = <span class="keyword">this</span>.film.width(),
        h = <span class="keyword">this</span>.film.height();

    <span class="keyword">this</span>.film.width(w).height(h);
    <span class="keyword">this</span>.screen.width(<span class="string">'auto'</span>).height(h);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Create prev/next buttons and page bullets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createControls: <span class="keyword">function</span>() {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">this</span>.controls = $(<span class="string">'&lt;span class="microfiche-controls" /&gt;'</span>).appendTo(<span class="keyword">this</span>.el);
    <span class="keyword">this</span>.controls.on(<span class="string">'click'</span>, <span class="string">'a, button'</span>, <span class="keyword">function</span>(e) { self.didClickControl(e) });

    <span class="keyword">if</span> (<span class="keyword">this</span>.options.bullets) <span class="keyword">this</span>.createBullets();
    <span class="keyword">if</span> (<span class="keyword">this</span>.options.buttons) <span class="keyword">this</span>.createButtons();

    <span class="keyword">this</span>.updateControls();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Create page bullets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createBullets: <span class="keyword">function</span>() {
    <span class="keyword">var</span> container = $(<span class="string">'&lt;span class="microfiche-bullets" /&gt;'</span>).appendTo(<span class="keyword">this</span>.controls);
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.totalPageCount(); i++) {
      $(<span class="string">'&lt;button&gt;'</span>)
      .addClass(<span class="string">'microfiche-bullet'</span>)
      .attr(<span class="string">'data-microfiche-page'</span>, i)
      .data(<span class="string">'action'</span>, <span class="string">'slideToPage'</span>)
      .data(<span class="string">'arguments'</span>, [i])
      .html(i + <span class="number">1</span>)
      .appendTo(container);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create prev/next buttons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createButtons: <span class="keyword">function</span>() {
    $(<span class="string">'&lt;button&gt;'</span>)
    .addClass(<span class="string">'microfiche-button microfiche-prev-button'</span>)
    .attr(<span class="string">'rel'</span>, <span class="string">'prev'</span>)
    .data(<span class="string">'action'</span>, <span class="string">'prev'</span>)
    .data(<span class="string">'arguments'</span>, [])
    .html(<span class="keyword">this</span>.options.prevButtonLabel)
    .prependTo(<span class="keyword">this</span>.controls);

    $(<span class="string">'&lt;button&gt;'</span>)
    .addClass(<span class="string">'microfiche-button microfiche-next-button'</span>)
    .attr(<span class="string">'rel'</span>, <span class="string">'next'</span>)
    .data(<span class="string">'action'</span>, <span class="string">'next'</span>)
    .data(<span class="string">'arguments'</span>, [])
    .html(<span class="keyword">this</span>.options.nextButtonLabel)
    .appendTo(<span class="keyword">this</span>.controls);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Add in the appropriate touch events. This requires a bit of scope-locking.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  enableTouch: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.options.swipe) <span class="keyword">return</span>;

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">var</span> thisTouchstart = <span class="keyword">this</span>.touchstart,
        thisTouchmove = <span class="keyword">this</span>.touchmove,
        thisTouchend = <span class="keyword">this</span>.touchend;

    <span class="keyword">this</span>.touchstart = <span class="keyword">function</span>() { thisTouchstart.apply(self, arguments) };
    <span class="keyword">this</span>.touchmove = <span class="keyword">function</span>() { thisTouchmove.apply(self, arguments) };
    <span class="keyword">this</span>.touchend = <span class="keyword">function</span>() { thisTouchend.apply(self, arguments) };

    <span class="keyword">this</span>.film.on(<span class="string">'touchstart'</span>, <span class="keyword">this</span>.touchstart);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Add in left-right keyboard events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  enableKeyboard: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.options.keyboard) <span class="keyword">return</span>;

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">this</span>.screen.attr(<span class="string">'data-microfiche-keyboard'</span>, <span class="literal">true</span>);
    <span class="keyword">var</span> thisOnkeydown = <span class="keyword">this</span>.onkeydown;
    <span class="keyword">this</span>.onkeydown = <span class="keyword">function</span>() { thisOnkeydown.apply(self, arguments) };

    $(document).on(<span class="string">'keydown'</span>, <span class="keyword">this</span>.onkeydown);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Add in mosuedown event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  enableClick: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.options.clickToAdvance) <span class="keyword">return</span>;

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">var</span> thisOnmousedown = <span class="keyword">this</span>.onmousedown;
    <span class="keyword">this</span>.onmousedown = <span class="keyword">function</span>() { thisOnmousedown.apply(self, arguments) };

    <span class="keyword">this</span>.film.on(<span class="string">'mousedown'</span>, <span class="keyword">this</span>.onmousedown);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2>User Event Handling</h2>
<p>When anything in <code>this.controls</code> is clicked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  didClickControl: <span class="keyword">function</span>(e) {
    e.preventDefault();

    <span class="keyword">var</span> control = $(e.target),
        action = control.data(<span class="string">'action'</span>),
        args = control.data(<span class="string">'arguments'</span>);

    <span class="keyword">this</span>[action].apply(<span class="keyword">this</span>, args);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>When touch starts, record the origin point and time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchstart: <span class="keyword">function</span>(e) {
    <span class="keyword">var</span> touches = e.originalEvent.targetTouches;

    <span class="keyword">if</span> (!touches || touches.length &gt; <span class="number">1</span>) <span class="keyword">return</span>;

    <span class="keyword">this</span>.touchState = {
      then   : <span class="keyword">new</span> Date(),
      ox     : touches[<span class="number">0</span>].pageX,
      oy     : touches[<span class="number">0</span>].pageY,
      isDrag : <span class="literal">false</span>
    }

    $(document).on(<span class="string">'touchmove'</span>, <span class="keyword">this</span>.touchmove).
                on(<span class="string">'touchend'</span>, <span class="keyword">this</span>.touchend);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Touchmove begins by getting the deltas on both axis.</p>
<p>If we’re not already in drag-mode, we check to see if the horizontal
delta is above the treshold. If the vertical delta crosses the threshold,
we duck out altogether.</p>
<p>After that, we ask <code>this.film</code> to follow the touch, and record a few
details about position and velocity for good measure.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchmove: <span class="keyword">function</span>(e) {
    <span class="keyword">var</span> t = e.originalEvent.targetTouches[<span class="number">0</span>],
        dx = t.pageX - <span class="keyword">this</span>.touchState.ox,
        dy = t.pageY - <span class="keyword">this</span>.touchState.oy;

    <span class="keyword">if</span> (!<span class="keyword">this</span>.touchState.isDrag) {
      <span class="keyword">if</span> (Math.abs(dy) &gt;= <span class="keyword">this</span>.options.dragThreshold) {
        <span class="keyword">this</span>.touchend();
        <span class="keyword">return</span>;
      } <span class="keyword">else</span> <span class="keyword">if</span> (Math.abs(dx) &gt;= <span class="keyword">this</span>.options.dragThreshold) {
        <span class="keyword">this</span>.touchState.isDrag = <span class="literal">true</span>;
      }
    }

    <span class="keyword">if</span> (<span class="keyword">this</span>.touchState.isDrag) {
      e.preventDefault();

      <span class="keyword">var</span> now = <span class="keyword">new</span> Date(),
          t = now - <span class="keyword">this</span>.touchState.then;

      <span class="keyword">this</span>.touchState.vx = (dx - <span class="keyword">this</span>.touchState.dx) / t;
      <span class="keyword">this</span>.touchState.vy = (dy - <span class="keyword">this</span>.touchState.dy) / t;
      <span class="keyword">this</span>.touchState.dx = dx;
      <span class="keyword">this</span>.touchState.dy = dy;
      <span class="keyword">this</span>.touchState.then = now;

      <span class="keyword">this</span>.touchState.cx = <span class="keyword">this</span>.x - dx;

      <span class="keyword">if</span> (!<span class="keyword">this</span>.options.cyclic) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.touchState.cx &lt; <span class="keyword">this</span>.min()) {
          <span class="keyword">var</span> bx = <span class="keyword">this</span>.min() - <span class="keyword">this</span>.touchState.cx;
          bx = bx * <span class="keyword">this</span>.options.elasticity;
          <span class="keyword">this</span>.touchState.cx = <span class="keyword">this</span>.min() - bx;
        }

        <span class="keyword">if</span> (<span class="keyword">this</span>.touchState.cx &gt; <span class="keyword">this</span>.max()) {
          <span class="keyword">var</span> bx = <span class="keyword">this</span>.touchState.cx - <span class="keyword">this</span>.max();
          bx = bx * <span class="keyword">this</span>.options.elasticity;
          <span class="keyword">this</span>.touchState.cx = <span class="keyword">this</span>.max() + bx;
        }
      }

      <span class="keyword">this</span>.film.css({
        WebkitTransition: <span class="string">'none'</span>,
        WebkitTransform: <span class="string">'translate3d('</span> + -<span class="keyword">this</span>.touchState.cx + <span class="string">'px, 0px, 0px)'</span>
      });
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>When the touch is finished, we unbind events. If the touch was decided
to be a drag, we’ll deduce the new target value for x, ensure Microfiche
knows about it, and animate into place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchend: <span class="keyword">function</span>(e) {
    $(document).off(<span class="string">'touchmove'</span>, <span class="keyword">this</span>.touchmove).
                off(<span class="string">'touchend'</span>, <span class="keyword">this</span>.touchend);

    <span class="keyword">if</span> (<span class="keyword">this</span>.touchState.isDrag) {
      <span class="keyword">var</span> dx = <span class="keyword">this</span>.touchState.dx,
           w = <span class="keyword">this</span>.screenWidth(),
          vx = <span class="keyword">this</span>.touchState.vx,
          th = <span class="keyword">this</span>.options.swipeThreshold;

      <span class="keyword">if</span> (dx &lt;= -w * th) {
        <span class="keyword">this</span>.slideByPages(<span class="number">1</span>, vx);
      } <span class="keyword">else</span> <span class="keyword">if</span> (dx &gt;= w * th) {
        <span class="keyword">this</span>.slideByPages(-<span class="number">1</span>, vx);
      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.slideByPages(<span class="number">0</span>);
      }
    }

  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Slide centermost instance of microfiche left / right on key press.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onkeydown: <span class="keyword">function</span>(e) {
    <span class="keyword">if</span> (e.keyCode !== <span class="number">37</span> &amp;&amp; e.keyCode !== <span class="number">39</span> || !<span class="keyword">this</span>.isCentral(<span class="string">'[data-microfiche-keyboard]'</span>)) <span class="keyword">return</span>;
    <span class="keyword">if</span> (e.keyCode === <span class="number">37</span>) <span class="keyword">this</span>.slideByPages(-<span class="number">1</span>);
    <span class="keyword">else</span> <span class="keyword">if</span> (e.keyCode === <span class="number">39</span>) <span class="keyword">this</span>.slideByPages(<span class="number">1</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Advance microfiche on mousedown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onmousedown: <span class="keyword">function</span>(e) {
    <span class="keyword">this</span>.slideByPages(<span class="number">1</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h2>State Update</h2>
<p>Enable/disable controls based on current position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  updateControls: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.options.bullets) <span class="keyword">this</span>.updateBullets();
    <span class="keyword">if</span> (<span class="keyword">this</span>.options.buttons) <span class="keyword">this</span>.updateButtons();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Update selected state of bullets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  updateBullets: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.controls.find(<span class="string">'.microfiche-bullet'</span>).removeClass(<span class="string">'selected'</span>);
    <span class="keyword">this</span>.controls.find(<span class="string">'[data-microfiche-page="'</span> + <span class="keyword">this</span>.currentPageIndex() + <span class="string">'"]'</span>).addClass(<span class="string">'selected'</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Update enabled state of prev/next buttons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  updateButtons: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.options.cyclic) <span class="keyword">return</span>;
    <span class="keyword">this</span>.controls.find(<span class="string">'[rel="prev"]'</span>).attr(<span class="string">'disabled'</span>, <span class="keyword">this</span>.x &lt;= <span class="keyword">this</span>.min());
    <span class="keyword">this</span>.controls.find(<span class="string">'[rel="next"]'</span>).attr(<span class="string">'disabled'</span>, <span class="keyword">this</span>.x &gt;= <span class="keyword">this</span>.max());
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h2>Helpers</h2>
<p>Round <code>x</code> to a factor of <code>screenWidth</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  round: <span class="keyword">function</span>(x) {
    <span class="keyword">var</span> w = <span class="keyword">this</span>.screenWidth();
    <span class="keyword">return</span> Math.round(x / w) * w;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Return <code>x</code> constrained between limits <code>min</code> and <code>max</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constrain: <span class="keyword">function</span>(x, min, max) {
    <span class="keyword">if</span> (min === <span class="literal">undefined</span>) min = <span class="keyword">this</span>.min();
    <span class="keyword">if</span> (max === <span class="literal">undefined</span>) max = <span class="keyword">this</span>.max();
    <span class="keyword">return</span> Math.max(min, Math.min(x, max));
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Round and constrain <code>x</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  roundAndConstrain: <span class="keyword">function</span>(x, min, max) {
    <span class="keyword">return</span> <span class="keyword">this</span>.constrain(<span class="keyword">this</span>.round(x), min, max);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns true if the given point is within our upper/lower bounds.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  withinBounds: <span class="keyword">function</span>(x) {
    <span class="keyword">return</span> <span class="keyword">this</span>.min() &lt;= x &amp;&amp; x &lt;= <span class="keyword">this</span>.max();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Returns the lower limit - simply 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  min: <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="number">0</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Returns the upper limit - the width of <code>this.film</code> less the width of
<code>this.screen</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  max: <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.film.width() - <span class="keyword">this</span>.screenWidth();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Returns the current page index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  currentPageIndex: <span class="keyword">function</span>() {
    <span class="keyword">return</span> Math.round(<span class="keyword">this</span>.x / <span class="keyword">this</span>.screenWidth());
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Returns the number of pages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  totalPageCount: <span class="keyword">function</span>() {
    <span class="keyword">return</span> Math.ceil(<span class="keyword">this</span>.film.width() / <span class="keyword">this</span>.screenWidth());
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Returns the width of the containing element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  screenWidth: <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.el.width();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Returns true if this microfiche instance is closest to the center of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isCentral: <span class="keyword">function</span>(selector) {

    <span class="keyword">var</span> closest = $($(selector || <span class="string">'.microfiche-screen'</span>).sort(<span class="keyword">function</span>(a,b){
      <span class="keyword">return</span> Math.abs(<span class="number">1</span> - (($(window).scrollTop()+$(window).height()/<span class="number">2</span>-$(a).height()/<span class="number">2</span>) / $(a).offset().top)) - 
             Math.abs(<span class="number">1</span> - (($(window).scrollTop()+$(window).height()/<span class="number">2</span>-$(b).height()/<span class="number">2</span>) / $(b).offset().top))
    })[<span class="number">0</span>]).parent().data(<span class="string">'microfiche'</span>);

    <span class="keyword">return</span> (closest === <span class="keyword">this</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2>Internal Methods for Performing Transitions</h2>
<p>Perform an instant transition to our new destination.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  jump: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.el.trigger(<span class="string">'microfiche:willMove'</span>);
    <span class="keyword">this</span>.performJump();
    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.el.trigger(<span class="string">'microfiche:didMove'</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Default jump transform.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  performJump: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.film.css({ left: -<span class="keyword">this</span>.x });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Sets up environment, but allows the real transition to be overridden.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  transition: <span class="keyword">function</span>(duration) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">if</span> (<span class="keyword">this</span>.options.cyclic) <span class="keyword">this</span>.handleWrappingTransition();

    <span class="keyword">if</span> (duration == <span class="literal">null</span>) duration = <span class="keyword">this</span>.options.duration;

    <span class="keyword">var</span> callback = <span class="keyword">function</span>() { self.afterTransition() };

    <span class="keyword">this</span>.el.trigger(<span class="string">'microfiche:willMove'</span>);

    setTimeout(<span class="keyword">function</span>() {
      self.performTransition(duration, callback);
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Handle what happens in cyclic mode if we’ve slipped off at either end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  handleWrappingTransition: <span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.x &gt; <span class="keyword">this</span>.max()) {
      <span class="keyword">this</span>.x = <span class="keyword">this</span>.min() - <span class="keyword">this</span>.screenWidth();
      <span class="keyword">if</span> (<span class="keyword">this</span>.touchState &amp;&amp; <span class="keyword">this</span>.touchState.dx) <span class="keyword">this</span>.x -= <span class="keyword">this</span>.touchState.dx;
      <span class="keyword">this</span>.jump();
      <span class="keyword">this</span>.x = <span class="keyword">this</span>.min();
      <span class="keyword">this</span>.updateControls();
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.x &lt; <span class="keyword">this</span>.min()) {
      <span class="keyword">this</span>.x = <span class="keyword">this</span>.max() + <span class="keyword">this</span>.screenWidth();
      <span class="keyword">if</span> (<span class="keyword">this</span>.touchState &amp;&amp; <span class="keyword">this</span>.touchState.dx) <span class="keyword">this</span>.x -= <span class="keyword">this</span>.touchState.dx;
      <span class="keyword">this</span>.jump();
      <span class="keyword">this</span>.x = <span class="keyword">this</span>.max();
      <span class="keyword">this</span>.updateControls();
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Default transition animation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  performTransition: <span class="keyword">function</span>(duration, callback) {
    <span class="keyword">this</span>.film.stop().animate({ left: -<span class="keyword">this</span>.x + <span class="string">'px'</span> }, duration, callback);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Called when a transition finishes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  afterTransition: <span class="keyword">function</span>() {
    <span class="keyword">delete</span> <span class="keyword">this</span>.touchState;
    <span class="keyword">this</span>.el.trigger(<span class="string">'microfiche:didMove'</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h2>Public API</h2>
<p>Slides by <code>n</code> pages. If <code>n</code> is negative, it will slide in reverse.</p>
<p>Also takes <code>vx</code>, which is the velocity on the x-axis. This is used
internally by the touch event handlers, but can be used to perform
a faster slide.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slideByPages: <span class="keyword">function</span>(n, vx) {
    <span class="keyword">var</span> ox = <span class="keyword">this</span>.x,
         w = <span class="keyword">this</span>.screenWidth();

    <span class="keyword">this</span>.x = <span class="keyword">this</span>.constrain((Math.round(<span class="keyword">this</span>.x / w) + n) * w);

    <span class="keyword">if</span> (<span class="keyword">this</span>.options.cyclic &amp;&amp; <span class="keyword">this</span>.x == ox) <span class="keyword">this</span>.x += n * w;

    <span class="keyword">if</span> (vx) {
      <span class="keyword">var</span> duration = <span class="keyword">this</span>.constrain(
        Math.abs((<span class="keyword">this</span>.x - ox) / vx),
        <span class="keyword">this</span>.options.minDuration,
        <span class="keyword">this</span>.options.maxDuration
      );
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> duration = <span class="keyword">this</span>.options.duration;
    }

    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.transition(duration);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Slides to the given <code>page</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slideToPage: <span class="keyword">function</span>(page) {
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.constrain(page * <span class="keyword">this</span>.screenWidth());
    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.transition();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Animate to the given point (constrained to an acceptable value).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slideToPoint: <span class="keyword">function</span>(x) {
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.roundAndConstrain(x);
    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.transition();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Jump to the given <code>page</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  jumpToPage: <span class="keyword">function</span>(page) {
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.constrain(page * <span class="keyword">this</span>.screenWidth());
    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.jump();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Jump to the given point (constrained to an acceptable value).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  jumpToPoint: <span class="keyword">function</span>(x) {
    <span class="keyword">this</span>.x = <span class="keyword">this</span>.roundAndConstrain(x);
    <span class="keyword">this</span>.updateControls();
    <span class="keyword">this</span>.jump();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Slide to the previous screen’s-worth of slides.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  prev: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.slideByPages(-<span class="number">1</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Slide to the next screen’s-worth of slides.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  next: <span class="keyword">function</span>() {
    <span class="keyword">this</span>.slideByPages(<span class="number">1</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Automatically call next every <code>n</code> seconds.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  autoplay: <span class="keyword">function</span>(n) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.autoplayTimeout) {
      clearInterval(<span class="keyword">this</span>.autoplayTimeout);
      <span class="keyword">delete</span> <span class="keyword">this</span>.autoplayTimeout;
    }

    n = +n;

    <span class="keyword">if</span> (isNaN(n) || n &lt;= <span class="number">0</span>) <span class="keyword">return</span>;

    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">this</span>.autoplayTimeout = setInterval(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">if</span> (!self.pause) {
        self.next();
      }
    }, n * <span class="number">1000</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Pause autoplay when hovering over carousel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  autopause: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">this</span>.el.hover(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      self.pause = <span class="literal">true</span>;
    }, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      self.pause = <span class="literal">false</span>;
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Run given commands, for example:</p>
<pre><code>microfiche.run({ slideByPages: 1 });</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run: <span class="keyword">function</span>(options) {
    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> options) {
      <span class="keyword">var</span> property = <span class="keyword">this</span>[key];
      <span class="keyword">if</span> ($.isFunction(property)) property.call(<span class="keyword">this</span>, options[key]);
    }
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2>WebKit Optimization</h2>
<p>A bit of feature detection for webkit transition support.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> ((<span class="string">'WebKitCSSMatrix'</span> <span class="keyword">in</span> window &amp;&amp; <span class="string">'m11'</span> <span class="keyword">in</span> <span class="keyword">new</span> WebKitCSSMatrix())) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>If we have webkit transition support, then override <code>prepareFilm</code>
and <code>transition</code> to take advantage of hardware acceleration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $.extend(Microfiche.prototype, {

    prepareFilm: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.film.css({ WebkitTransform: <span class="string">'translate3d(0px, 0px, 0px)'</span> });
    },

    performTransition: <span class="keyword">function</span>(duration, callback) {
      <span class="keyword">this</span>.film.one(<span class="string">'webkitTransitionEnd'</span>, callback).css({
        WebkitTransition: <span class="string">'-webkit-transform '</span> + duration + <span class="string">'ms'</span>,
        WebkitTransform: <span class="string">'translate3d('</span> + -<span class="keyword">this</span>.x + <span class="string">'px, 0px, 0px)'</span>
      });
    },

    performJump: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.film.css({
        WebkitTransition: <span class="string">'-webkit-transform 0ms'</span>,
        WebkitTransform: <span class="string">'translate3d('</span> + -<span class="keyword">this</span>.x + <span class="string">'px, 0px, 0px)'</span>
      });
    }

  });
}</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2>jQuery.fn.microfiche</h2>
<p>Creates microfiche elements and sends them commands.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.fn.microfiche = <span class="keyword">function</span>(options) {
  <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="keyword">function</span>() {
    <span class="keyword">var</span> microfiche = $(<span class="keyword">this</span>).data(<span class="string">'microfiche'</span>);

    <span class="keyword">if</span> (microfiche) {
      microfiche.run(options);
    } <span class="keyword">else</span> {
      <span class="keyword">new</span> Microfiche($.extend({ el: <span class="keyword">this</span> }, options));
    }
  });
}

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
