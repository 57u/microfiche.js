<!DOCTYPE html>  <html> <head>   <title>microfiche.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               microfiche.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Microfiche.js v0.9.0</h1>

<h2>Usage</h2>

<pre><code>$('.my-slideshow').microfiche();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">Microfiche</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">};</span>

<span class="nx">Microfiche</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.9.0&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Microfiche</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The default options, which can be overridden by the initializer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">minDuration</span>    <span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="nx">duration</span>       <span class="o">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="nx">maxDuration</span>    <span class="o">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="nx">dragThreshold</span>  <span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nx">elasticity</span>     <span class="o">:</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="nx">debounce</span>       <span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="nx">touchDragLower</span> <span class="o">:</span> <span class="mf">0.125</span><span class="p">,</span>
    <span class="nx">touchDragUpper</span> <span class="o">:</span> <span class="mf">0.75</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Rather than relying on the literal position of <code>this.film</code>,
we keep a tab on the current destination.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Build microfiche in steps.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createFilm</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createScreen</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">calibrate</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">createControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enableTouch</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prepareCyclic</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We create our film element, which we’ll slide back and forth in the screen.
Before appending any extra elements, we detach the existing children,
append them to film, and tell them to float so they’ll (hopefully) lay-out
nicely along the horizontal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createFilm</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">film</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;microfiche-film&quot;&gt;&#39;</span><span class="p">).</span>
    <span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="kr">float</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prepareFilm</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareFilm</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The screen is created and appended to our element, then the film is
appended to the screen. Screen manually takes its height from film.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createScreen</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;microfiche-screen&quot;&gt;&#39;</span><span class="p">).</span>
    <span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span> <span class="nx">overflow</span><span class="o">:</span> <span class="s1">&#39;hidden&#39;</span> <span class="p">}).</span>
    <span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span>
    <span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This slightly strange process tries to ensure we don’t get any wrapping
in <code>this.film</code>, then fixes the dimensions of <code>this.film</code> and <code>this.screen</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">calibrate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>We keep controls in a Hash called <code>this.controls</code>. There’s a bit of
jQuery chaining here, so look closesly when adding extra controls.
For the time being, we’re binding control elements directly to their
respective actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createControls</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">prev</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button class=&quot;microfiche-prev-button&quot;&gt;&amp;larr;&lt;/button&gt;&#39;</span><span class="p">).</span>
            <span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click touchstart&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="nx">self</span><span class="p">.</span><span class="nx">prev</span><span class="p">()</span> <span class="p">}),</span>
      <span class="nx">next</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button class=&quot;microfiche-next-button&quot;&gt;&amp;rarr;&lt;/button&gt;&#39;</span><span class="p">).</span>
            <span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click touchstart&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="nx">self</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span> <span class="p">})</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Add in the appropriate touch events. This requires a bit of scope-locking.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">enableTouch</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">thisTouchstart</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span><span class="p">,</span>
        <span class="nx">thisTouchmove</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">,</span>
        <span class="nx">thisTouchend</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchstart</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchmove</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>When touch starts, record the origin point and time.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchstart</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">touches</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">touches</span> <span class="o">||</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">then</span>   <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
      <span class="nx">ox</span>     <span class="o">:</span> <span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageX</span><span class="p">,</span>
      <span class="nx">oy</span>     <span class="o">:</span> <span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageY</span><span class="p">,</span>
      <span class="nx">isDrag</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">).</span>
                <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Touchmove begins by getting the deltas on both axis.</p>

<p>If we’re not already in drag-mode, we check to see if the horizontal
delta is above the treshold. If the vertical delta crosses the threshold,
we duck out altogether.</p>

<p>After that, we ask <code>this.film</code> to follow the touch, and record a few
details about position and velocity for good measure.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchmove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">ox</span><span class="p">,</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">oy</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dy</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dragThreshold</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dragThreshold</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

      <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
          <span class="nx">t</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">then</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">/</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">/</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nx">dx</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nx">dy</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">dx</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">())</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span><span class="p">;</span>
          <span class="nx">bx</span> <span class="o">=</span> <span class="nx">bx</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">elasticity</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">-</span> <span class="nx">bx</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">())</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
          <span class="nx">bx</span> <span class="o">=</span> <span class="nx">bx</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">elasticity</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">()</span> <span class="o">+</span> <span class="nx">bx</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>When the touch is finished, we unbind events. If the touch was decided
to be a drag, we’ll deduce the new target value for x, ensure Microfiche
knows about it, and animate into place.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">).</span>
                <span class="nx">off</span><span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">,</span>
           <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">(),</span>
          <span class="nx">vx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vx</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If we’re in cyclic mode, or the desired x point if within bounds,
then the threshold for shuttling to the next point if lower.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">withinBounds</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">th</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">touchDragLower</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">th</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">touchDragUpper</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nx">w</span> <span class="o">*</span> <span class="nx">th</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">shuttle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">vx</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">&gt;=</span> <span class="nx">w</span> <span class="o">*</span> <span class="nx">th</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">shuttle</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">vx</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">shuttle</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Slide to the previous screen’s-worth of slides.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">prev</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shuttle</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Slide to the next screen’s-worth of slides.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shuttle</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Enable/disable controls based on current position.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">updateControls</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">prev</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">next</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Microfiche shuttles by the screenful, so <code>direction</code> represents
screenfuls in either direction. Normally you’d use +/- 1, but larger
units should work fine too.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">shuttle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">vx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ox</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
         <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">+</span> <span class="nx">direction</span><span class="p">)</span> <span class="o">*</span> <span class="nx">w</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="nx">ox</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">direction</span> <span class="o">*</span> <span class="nx">w</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">vx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="nx">vx</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">minDuration</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">maxDuration</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Return <code>x</code> constrained between limits <code>min</code> and <code>max</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">constrain</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">min</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">min</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">max</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">max</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">max</span><span class="p">));</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Returns true if the given point is within our upper/lower bounds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">withinBounds</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Returns the lower limit - simply 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">min</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Returns the upper limit - the width of <code>this.film</code> less the width of
<code>this.screen</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">max</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Perform the actual animation to our new destination.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">stop</span><span class="p">().</span><span class="nx">animate</span><span class="p">(</span>
      <span class="p">{</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">},</span>
      <span class="nx">duration</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">afterTransition</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Perform an instant transition to our new destination.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Returns the width of the containing element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">screenWidth</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Prepare duplicate content at either end, for our cyclic behaviour.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">prepareCyclic</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cloneL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span>
        <span class="nx">cloneR</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span>
        <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>

    <span class="nx">cloneL</span><span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">});</span>
    <span class="nx">cloneR</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Called when a transition finishes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">afterTransition</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>A bit of feature detection for webkit transition support.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">wkt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">WebkitTransition</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">wkt</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">wkt</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If we have webkit transition support, then override <code>prepareFilm</code>
and <code>transition</code> to take advantage of hardware acceleration.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Microfiche</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">prepareFilm</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(0px, 0px, 0px)&#39;</span> <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span>
        <span class="s1">&#39;webkitTransitionEnd&#39;</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">afterTransition</span><span class="p">()</span> <span class="p">}</span>
      <span class="p">).</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;-webkit-transform &#39;</span> <span class="o">+</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;-webkit-transform 0ms&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">});</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>A bit of feature detection for moz transition support.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">moz</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">moz</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">moz</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>If we have moz transition support, then override <code>prepareFilm</code>
and <code>transition</code> to take advantage of hardware acceleration.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Microfiche</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">prepareFilm</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">MozTransform</span><span class="o">:</span> <span class="s1">&#39;translate(0px, 0px)&#39;</span> <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span>
        <span class="s1">&#39;mozTransitionEnd&#39;</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">afterTransition</span><span class="p">()</span> <span class="p">}</span>
      <span class="p">).</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">MozTransition</span><span class="o">:</span> <span class="s1">&#39;-moz-transform &#39;</span> <span class="o">+</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span>
        <span class="nx">MozTransform</span><span class="o">:</span> <span class="s1">&#39;translate(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">MozTransition</span><span class="o">:</span> <span class="s1">&#39;-moz-transform 0ms&#39;</span><span class="p">,</span>
        <span class="nx">MozTransform</span><span class="o">:</span> <span class="s1">&#39;translate(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">});</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Turn selector-ed elements into Microfiche slideshows.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">microfiche</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nx">Microfiche</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span> <span class="nx">el</span><span class="o">:</span> <span class="k">this</span> <span class="p">},</span> <span class="nx">options</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 