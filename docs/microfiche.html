<!DOCTYPE html>  <html> <head>   <title>microfiche.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               microfiche.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Microfiche.js v1.3.3</h1>

<h2>Usage</h2>

<pre><code>$('.my-slideshow').microfiche();
$('.my-slideshow').microfiche({ cyclic: true, button: false });
$('.my-slideshow').microfiche({ slideByPages: 1 });
</code></pre>

<h2>Options</h2>

<p>The following options can be passed the first time <code>microfiche</code> is called
on an element.</p>

<h3>cyclic</h3>

<p>If true, microfiche wraps around at front and beginning of the slideshow.
This option is false by default.</p>

<pre><code>$('.my-slideshow').microfiche({ cyclic: true });
</code></pre>

<h3>buttons</h3>

<p>If true, microfiche will create previous/next buttons.
This option is true by default.</p>

<pre><code>$('.my-slideshow').microfiche({ buttons: false });
</code></pre>

<h3>bullets</h3>

<p>If true, microfiche will create bullets for the pages available.
This option is also true by default.</p>

<pre><code>$('.my-slideshow').microfiche({ bullets: false });
</code></pre>

<h2>Commands</h2>

<p>The following commands can be run on a microfiche'd element at any point,
including in the first call.</p>

<h3>slideByPages</h3>

<p>Slides <code>n</code> screenfuls (negative <code>n</code> goes backwards).</p>

<pre><code>$('.my-slideshow').microfiche({ slideByPages: n });
</code></pre>

<h3>slideToPage</h3>

<p>Slides to the <code>nth</code> screenful.</p>

<pre><code>$('.my-slideshow').microfiche({ slideToPage: n });
</code></pre>

<h3>slideToPoint</h3>

<p>Slides to point <code>x</code> (rounded and constrained appropriately).</p>

<pre><code>$('.my-slideshow).microfiche({ slideToPoint: x });
</code></pre>

<h3>jumpToPoint</h3>

<p>Jumps without animation to point x (again, rounded and constrained).</p>

<pre><code>$('.my-slideshow').microfiche({ jumpToPoint: x });
</code></pre>

<h3>autoplay</h3>

<p>Automatically advances every <code>n</code> seconds.</p>

<pre><code>$('.my-slideshow').microfiche({ autoplay: n });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Microfiche</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">};</span>

<span class="nx">Microfiche</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;1.3.3&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Microfiche</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Default Options</h2>

<p>These may be overridden in the initializer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">autoplay</span>        <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">buttons</span>         <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">bullets</span>         <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">cyclic</span>          <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">keyboard</span>        <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">swipe</span>           <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">clickToAdvance</span>  <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">minDuration</span>     <span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="nx">duration</span>        <span class="o">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="nx">maxDuration</span>     <span class="o">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="nx">dragThreshold</span>   <span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nx">elasticity</span>      <span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="nx">swipeThreshold</span>  <span class="o">:</span> <span class="mf">0.125</span><span class="p">,</span>
    <span class="nx">prevButtonLabel</span> <span class="o">:</span> <span class="s1">&#39;&amp;larr;&#39;</span><span class="p">,</span>
    <span class="nx">nextButtonLabel</span> <span class="o">:</span> <span class="s1">&#39;&amp;rarr;&#39;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Rather than relying on the literal position of <code>this.film</code>,
we keep a tab on the current destination.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Setup</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Build microfiche in steps.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;microfiche&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createFilm</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createScreen</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">calibrate</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">createControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enableTouch</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enableKeyboard</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enableClick</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prepareCyclic</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We create our film element, which we’ll slide back and forth in the screen.
Before appending any extra elements, we detach the existing children,
append them to film, and tell them to float so they’ll (hopefully) lay-out
nicely along the horizontal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createFilm</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">film</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;microfiche-film&quot;&gt;&#39;</span><span class="p">).</span>
    <span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="kr">float</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prepareFilm</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">prepareFilm</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The screen is created and appended to our element, then the film is
appended to the screen. Screen manually takes its height from film.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createScreen</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;microfiche-screen&quot;&gt;&#39;</span><span class="p">).</span>
    <span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span> <span class="nx">overflow</span><span class="o">:</span> <span class="s1">&#39;hidden&#39;</span> <span class="p">}).</span>
    <span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span>
    <span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Prepare duplicate content at either end, for our cyclic behaviour.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">prepareCyclic</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cloneL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span>
        <span class="nx">cloneR</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span>
        <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>

    <span class="nx">cloneL</span><span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">});</span>
    <span class="nx">cloneR</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>This slightly strange process tries to ensure we don’t get any wrapping
in <code>this.film</code>, then fixes the dimensions of <code>this.film</code> and <code>this.screen</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">calibrate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Create prev/next buttons and page bullets.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createControls</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;microfiche-controls&quot; /&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;a, button&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">didClickControl</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bullets</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">createBullets</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">buttons</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">createButtons</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Create page bullets.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createBullets</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;microfiche-bullets&quot; /&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">totalPageCount</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;microfiche-bullet&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-microfiche-page&#39;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;slideToPage&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">i</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Create prev/next buttons.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">createButtons</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;microfiche-button microfiche-prev-button&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;prev&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;prev&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">prevButtonLabel</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;microfiche-button microfiche-next-button&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">nextButtonLabel</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Add in the appropriate touch events. This requires a bit of scope-locking.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">enableTouch</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">swipe</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">thisTouchstart</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span><span class="p">,</span>
        <span class="nx">thisTouchmove</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">,</span>
        <span class="nx">thisTouchend</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchstart</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchmove</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisTouchend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchstart</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Add in left-right keyboard events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">enableKeyboard</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-microfiche-keyboard&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">thisOnkeydown</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onkeydown</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisOnkeydown</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onkeydown</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Add in mosuedown event.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">enableClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">clickToAdvance</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">thisOnmousedown</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onmousedown</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onmousedown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">thisOnmousedown</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onmousedown</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>User Event Handling</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>When anything in <code>this.controls</code> is clicked.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">didClickControl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">),</span>
        <span class="nx">action</span> <span class="o">=</span> <span class="nx">control</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">),</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="nx">control</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">[</span><span class="nx">action</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>When touch starts, record the origin point and time.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchstart</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">touches</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">touches</span> <span class="o">||</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">then</span>   <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
      <span class="nx">ox</span>     <span class="o">:</span> <span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageX</span><span class="p">,</span>
      <span class="nx">oy</span>     <span class="o">:</span> <span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageY</span><span class="p">,</span>
      <span class="nx">isDrag</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">).</span>
                <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Touchmove begins by getting the deltas on both axis.</p>

<p>If we’re not already in drag-mode, we check to see if the horizontal
delta is above the treshold. If the vertical delta crosses the threshold,
we duck out altogether.</p>

<p>After that, we ask <code>this.film</code> to follow the touch, and record a few
details about position and velocity for good measure.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchmove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">ox</span><span class="p">,</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">oy</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dy</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dragThreshold</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dragThreshold</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

      <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
          <span class="nx">t</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">then</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="o">/</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dy</span><span class="p">)</span> <span class="o">/</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span> <span class="o">=</span> <span class="nx">dx</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dy</span> <span class="o">=</span> <span class="nx">dy</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">dx</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">())</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span><span class="p">;</span>
          <span class="nx">bx</span> <span class="o">=</span> <span class="nx">bx</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">elasticity</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">-</span> <span class="nx">bx</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">())</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">bx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
          <span class="nx">bx</span> <span class="o">=</span> <span class="nx">bx</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">elasticity</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">()</span> <span class="o">+</span> <span class="nx">bx</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">cx</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>When the touch is finished, we unbind events. If the touch was decided
to be a drag, we’ll deduce the new target value for x, ensure Microfiche
knows about it, and animate into place.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">touchend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;touchmove&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchmove</span><span class="p">).</span>
                <span class="nx">off</span><span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchend</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">,</span>
           <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">(),</span>
          <span class="nx">vx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">vx</span><span class="p">,</span>
          <span class="nx">th</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">swipeThreshold</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nx">w</span> <span class="o">*</span> <span class="nx">th</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">vx</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">&gt;=</span> <span class="nx">w</span> <span class="o">*</span> <span class="nx">th</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">vx</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Slide centermost instance of microfiche left / right on key press.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">onkeydown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">!==</span> <span class="mi">37</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">!==</span> <span class="mi">39</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isCentral</span><span class="p">(</span><span class="s1">&#39;[data-microfiche-keyboard]&#39;</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">37</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">39</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Advance microfiche on mousedown.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">onmousedown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h2>State Update</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Enable/disable controls based on current position.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">updateControls</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bullets</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateBullets</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">buttons</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateButtons</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Update selected state of bullets.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">updateBullets</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.microfiche-bullet&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;[data-microfiche-page=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentPageIndex</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Update enabled state of prev/next buttons.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">updateButtons</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;[rel=&quot;prev&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;[rel=&quot;next&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">());</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h2>Helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Round <code>x</code> to a factor of <code>screenWidth</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">round</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">*</span> <span class="nx">w</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Return <code>x</code> constrained between limits <code>min</code> and <code>max</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">constrain</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">min</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">min</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">max</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">max</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">max</span><span class="p">));</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Round and constrain <code>x</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">roundAndConstrain</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Returns true if the given point is within our upper/lower bounds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">withinBounds</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Returns the lower limit - simply 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">min</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Returns the upper limit - the width of <code>this.film</code> less the width of
<code>this.screen</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">max</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Returns the current page index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">currentPageIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">());</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Returns the number of pages.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">totalPageCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">());</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Returns the width of the containing element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">screenWidth</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Returns true if this microfiche instance is closest to the center of the screen</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">isCentral</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">closest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span> <span class="o">||</span> <span class="s1">&#39;.microfiche-screen&#39;</span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">))</span> <span class="o">-</span> 
             <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">$</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">$</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">))</span>
    <span class="p">})[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;microfiche&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">closest</span> <span class="o">===</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <h2>Internal Methods for Performing Transitions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Perform an instant transition to our new destination.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;microfiche:willMove&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">performJump</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;microfiche:didMove&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Default jump transform.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">performJump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Sets up environment, but allows the real transition to be overridden.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleWrappingTransition</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">afterTransition</span><span class="p">()</span> <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;microfiche:willMove&#39;</span><span class="p">);</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">performTransition</span><span class="p">(</span><span class="nx">duration</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Handle what happens in cyclic mode if we’ve slipped off at either end.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">handleWrappingTransition</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">min</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">()</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">touchState</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">.</span><span class="nx">dx</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Default transition animation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">performTransition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">stop</span><span class="p">().</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span> <span class="p">},</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Called when a transition finishes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">afterTransition</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchState</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;microfiche:didMove&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h2>Public API</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Slides by <code>n</code> pages. If <code>n</code> is negative, it will slide in reverse.</p>

<p>Also takes <code>vx</code>, which is the velocity on the x-axis. This is used
internally by the touch event handlers, but can be used to perform
a faster slide.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">slideByPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">vx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ox</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
         <span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)</span> <span class="o">*</span> <span class="nx">w</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cyclic</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="nx">ox</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">n</span> <span class="o">*</span> <span class="nx">w</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">vx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="nx">vx</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">minDuration</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">maxDuration</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Slides to the given <code>page</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">slideToPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">(</span><span class="nx">page</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Animate to the given point (constrained to an acceptable value).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">slideToPoint</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">roundAndConstrain</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Jump to the given <code>page</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">jumpToPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constrain</span><span class="p">(</span><span class="nx">page</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenWidth</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Jump to the given point (constrained to an acceptable value).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">jumpToPoint</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">roundAndConstrain</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateControls</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">();</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Slide to the previous screen’s-worth of slides.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">prev</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Slide to the next screen’s-worth of slides.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">slideByPages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Automatically call next every <code>n</code> seconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">autoplay</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoplayTimeout</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoplayTimeout</span><span class="p">)</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoplayTimeout</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">n</span> <span class="o">=</span> <span class="o">+</span><span class="nx">n</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">||</span> <span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">autoplayTimeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span> <span class="p">},</span> <span class="nx">n</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;microfiche:willMove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">autoplay</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Run given commands, for example:</p>

<pre><code>microfiche.run({ slideByPages: 1 });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="nx">property</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <h2>WebKit Optimization</h2>

<p>A bit of feature detection for webkit transition support.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">wkt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">WebkitTransition</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">wkt</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">wkt</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>If we have webkit transition support, then override <code>prepareFilm</code>
and <code>transition</code> to take advantage of hardware acceleration.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Microfiche</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">prepareFilm</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(0px, 0px, 0px)&#39;</span> <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">performTransition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;webkitTransitionEnd&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;-webkit-transform &#39;</span> <span class="o">+</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">performJump</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">film</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">WebkitTransition</span><span class="o">:</span> <span class="s1">&#39;-webkit-transform 0ms&#39;</span><span class="p">,</span>
        <span class="nx">WebkitTransform</span><span class="o">:</span> <span class="s1">&#39;translate3d(&#39;</span> <span class="o">+</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px, 0px, 0px)&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">});</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h2>jQuery.fn.microfiche </h2>

<p>Creates microfiche elements and sends them commands.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">microfiche</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">microfiche</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;microfiche&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">microfiche</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">microfiche</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">new</span> <span class="nx">Microfiche</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span> <span class="nx">el</span><span class="o">:</span> <span class="k">this</span> <span class="p">},</span> <span class="nx">options</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 